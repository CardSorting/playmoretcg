{% extends "base.html" %}

{% block title %}Sign In - AI Card Creator{% endblock %}

{% block head %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Clear any existing instances
        if (ui) {
            ui.delete();
        }

        const uiConfig = {
            signInOptions: [{
                provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
                requireDisplayName: false,
                signInMethod: firebase.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD
            }],
            signInFlow: 'popup',
            callbacks: {
                signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                    // Handle successful sign-in
																				if (authResult.user) {
                        return true;
                    }
                    return false;
                },
                signInFailure: function(error) {
                    // Handle sign-in errors
                    console.error('Sign-in error:', error);
                    if (error.code === 'auth/account-exists-with-different-credential') {
                        // Handle existing account with different credentials
                        alert('An account already exists with this email. Please sign in with the correct provider.');
                    }
                }
            },
            autoUpgradeAnonymousUsers: false,
            signInSuccessUrl: '/collection'
        };

        // Initialize UI with new config
        const authUI = new firebaseui.auth.AuthUI(firebase.auth());
        authUI.start('#firebaseui-auth-container', uiConfig);
    });
</script>

<style>
    .firebaseui-container {
        max-width: 100% !important;
    }
    .firebaseui-card-content {
        padding: 20px !important;
    }
    .firebaseui-title {
        display: none !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-8">
    <div class="bg-white p-6 rounded shadow">
        <h1 class="text-2xl mb-4 text-center">Sign In</h1>
        <div id="firebaseui-auth-container"></div>
    </div>
</div>
{% endblock %}